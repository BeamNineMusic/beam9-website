<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Beam9 — Official Site</title>
  <meta name="description" content="Beam9 music hub — watch songs on YouTube, browse by tags, and ask for recommendations." />
  <meta property="og:title" content="Beam9 — Official Site" />
  <meta property="og:description" content="Beam9 music hub — watch songs on YouTube, browse by tags, and ask for recommendations." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    body{margin:0;font-family:system-ui;background:#0b1020;color:#e5e7eb}
    .container{max-width:1000px;margin:auto;padding:20px}
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:center}
    .aspect-video{position:relative;width:100%;padding-top:56.25%;background:#000;border-radius:12px;overflow:hidden}
    .aspect-video iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    .toolbar{display:flex;flex-wrap:wrap;gap:12px;margin:20px 0;align-items:center}
    .search{flex:1 1 260px;display:flex;align-items:center;background:#0f1a33;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px 12px}
    .search input{flex:1;background:transparent;border:0;color:#e5e7eb;outline:none;font-size:14px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{border:1px solid rgba(255,255,255,.14);background:#0f152a;border-radius:999px;padding:6px 12px;font-weight:600;font-size:12px;color:#d1d5db;cursor:pointer}
    .chip.active{border-color:#22d3ee;box-shadow:0 0 0 3px rgba(34,211,238,.35)}
    .sort{margin-left:auto}
    select{background:#0f172a;color:#e5e7eb;border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:6px 10px;font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:20px}
    .card{background:#0f172a;padding:10px;border-radius:12px;cursor:pointer;display:flex;flex-direction:column}
    .card img{width:100%;border-radius:8px}
    .title-sm{font-weight:700;margin:6px 0}
    .tags{font-size:12px;opacity:.75}
    footer{margin-top:30px;font-size:14px;opacity:.75;text-align:center}
    h1{font-size:28px;margin:0 0 10px;font-weight:800}
    /* Assistant */
    #assistant{margin-top:40px;padding:20px;background:#0f172a;border-radius:12px;border:1px solid rgba(255,255,255,.12)}
    #assistant h2{margin-top:0;font-size:20px}
    #assistant form{display:flex;gap:10px}
    #assistant input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:#0b1020;color:#e5e7eb}
    #assistant button{padding:10px 14px;border-radius:8px;background:#22d3ee;border:none;color:#0b1020;font-weight:700;cursor:pointer}
    #assistant .recs{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .rec{background:#0b152a;border:1px solid rgba(255,255,255,.08);border-radius:10px;overflow:hidden;cursor:pointer}
    .rec .meta{padding:8px 10px}
    .rec .meta .t{font-weight:700}
    .rec .meta .g{font-size:12px;opacity:.75}
  </style>
</head>
<body>
  <div class="container">
    <section id="home" class="hero">
      <div>
        <h1 id="hero-title">Zombie Cat</h1>
        <p>A tiny, fast Beam9 hub. Click a thumbnail to watch on YouTube. No logins, no fuss.</p>
      </div>
      <div class="aspect-video">
        <iframe id="hero-iframe" src="" allowfullscreen loading="lazy" referrerpolicy="origin-when-cross-origin" title="Beam9 Player"></iframe>
      </div>
    </section>

    <section id="music">
      <div class="toolbar">
        <div class="search" role="search"><span style="margin-right:8px">🔎</span>
          <input id="q" placeholder="Search songs or tags… (e.g., lullaby, thai, afrobeats)" aria-label="Search" />
        </div>
        <div class="sort">
          <label for="sortSelect" class="sr-only">Sort by</label>
          <select id="sortSelect">
            <option value="latest">Latest</option>
            <option value="az">A–Z</option>
          </select>
        </div>
      </div>
      <div id="chips" class="chips"></div>
      <div id="grid" class="grid"></div>
    </section>

    <section id="assistant" aria-label="Ask Beam9">
      <h2>🤖 Ask Beam9</h2>
      <form onsubmit="event.preventDefault(); askAssistant();">
        <input id="askbox" placeholder="calm thai lullaby • play zombie • shuffle • latest" />
        <button type="submit">Suggest</button>
      </form>
      <div id="recs" class="recs" role="list"></div>
    </section>

    <footer>
      Beam9 © <span id="year"></span> — Links: <a href="https://www.youtube.com/@iammrbeam9" target="_blank" rel="noopener">YouTube</a> · <a href="#">Spotify</a> · <a href="#">Apple Music</a>
    </footer>
  </div>

  <script>
    // ---------- State ----------
    let tracks = [];
    const byId = id => document.getElementById(id);
    byId('year').textContent = new Date().getFullYear();

    // ---------- UI helpers ----------
    function cardHTML(t){
      const thumb = `https://img.youtube.com/vi/${t.youtubeId}/hqdefault.jpg`;
      return `<div class="card" data-yid="${t.youtubeId}" data-title="${t.title}">
        <img src="${thumb}" alt="${t.title}">
        <div class="title-sm">${t.title}</div>
        <div class="tags">${(t.tags||[]).join(' · ')}</div>
      </div>`;
    }

    function render(){
      const grid = byId('grid');
      const q = (byId('q')?.value||'').trim().toLowerCase();
      const activeTags = new Set([...document.querySelectorAll('.chip.active')].map(c=>c.dataset.tag));
      let list = tracks.slice();

      if(q){ list = list.filter(t => t.title.toLowerCase().includes(q) || (t.tags||[]).some(tag=>tag.toLowerCase().includes(q))); }
      if(activeTags.size){ list = list.filter(t => (t.tags||[]).some(tag => activeTags.has(tag.toLowerCase()))); }

      const sortVal = byId('sortSelect')?.value || 'latest';
      if(sortVal === 'latest'){
        list.sort((a,b)=> new Date(b.releaseDate) - new Date(a.releaseDate));
      } else if(sortVal === 'az'){
        list.sort((a,b)=> a.title.localeCompare(b.title));
      }

      grid.innerHTML = list.map(cardHTML).join('');
    }

    function playTrack(id,title){
      const url = `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&mute=1&rel=0&modestbranding=1&playsinline=1`;
      byId('hero-iframe').src = url;
      byId('hero-title').textContent = title;
    }

    // ---------- Assistant ----------
    function recHTML(list){
      return list.map(t=>{
        const thumb = `https://img.youtube.com/vi/${t.youtubeId}/mqdefault.jpg`;
        return `<article class="rec" data-yid="${t.youtubeId}" data-title="${t.title}">
          <img src="${thumb}" alt="${t.title}">
          <div class="meta"><div class="t">${t.title}</div><div class="g">${(t.tags||[]).join(' · ')}</div></div>
        </article>`;
      }).join('');
    }

    function askAssistant(){
      const input = byId('askbox');
      const text = (input?.value || '').toLowerCase().trim();

      // Commands
      if (text.startsWith('play ')){
        const term = text.replace(/^play\s+/, '').trim();
        const hit = tracks.find(t => t.title.toLowerCase().includes(term));
        if (hit){
          playTrack(hit.youtubeId, hit.title);
          byId('recs').innerHTML = recHTML([hit]);
          return;
        }
      }
      if (text === 'shuffle'){
        const shuffled = tracks.slice();
        for (let i=shuffled.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]]; }
        byId('recs').innerHTML = recHTML(shuffled.slice(0,6));
        return;
      }
      if (text === 'latest' || text === ''){
        const latest = tracks.slice().sort((a,b)=>new Date(b.releaseDate)-new Date(a.releaseDate)).slice(0,6);
        byId('recs').innerHTML = recHTML(latest);
        return;
      }

      // Simple intent scoring
      const wants = new Set();
      if(/calm|sleep|relax|lullaby|ช้า/.test(text)) wants.add('lullaby');
      if(/sad|cry|lonely|เศร้า|เสียใจ/.test(text)) wants.add('sad');
      if(/happy|สนุก|โจ๊ะ|dance|party|มัน/.test(text)) wants.add('dance');
      if(/encourag|ฮึบ|สู้|ไฟ/.test(text)) wants.add('encouragement');
      if(/thai|ภาษาไทย|thai.pop|thai pop/.test(text)) wants.add('thai');
      if(/rap|แร็พ/.test(text)) wants.add('rap');
      if(/afro|afrobeats/.test(text)) wants.add('afrobeats');
      if(/remix|mix|remixed/.test(text)) wants.add('remix');
      if(/ballad/.test(text)) wants.add('ballad');
      if(/tradition|ลูกทุ่ง|พื้นบ้าน/.test(text)) wants.add('tradition');

      const scored = tracks.map(t=>{
        let s = 0;
        const tagsLC = (t.tags||[]).map(x=>String(x).toLowerCase());
        s += tagsLC.filter(tag => wants.has(tag)).length * 2;
        if (text) {
          if (t.title.toLowerCase().includes(text)) s += 2;
          s += tagsLC.filter(tag => text.includes(tag) || tag.includes(text)).length;
        }
        if (t.releaseDate) s += new Date(t.releaseDate).getTime()/1e13;
        return {t, s};
      }).sort((a,b)=>b.s-a.s)
        .filter(x=>x.s>0)
        .slice(0,6)
        .map(x=>x.t);

      byId('recs').innerHTML = recHTML(scored.length ? scored : tracks.slice(0,6));
    }

    // One-time click handler (grid + assistant)
    document.addEventListener('click', e=>{
      // Grid cards
      const card = e.target.closest('#grid [data-yid]');
      if(card){ playTrack(card.dataset.yid, card.dataset.title); return; }
      // Assistant recs
      const rec = e.target.closest('#recs .rec');
      if(rec){ playTrack(rec.dataset.yid, rec.dataset.title); byId('home')?.scrollIntoView({behavior:'smooth'}); }
    });

    // Live suggestions (debounced)
    (function(){
      const input = byId('askbox');
      if(!input) return;
      let t;
      input.addEventListener('input', ()=>{
        clearTimeout(t);
        t = setTimeout(()=>{
          if(input.value.trim().length>=2) askAssistant();
        }, 160);
      });
    })();

    // ---------- Init ----------
    async function loadTracks(){
      try {
        const res = await fetch('tracks.json?ver=' + Date.now(), { cache: 'no-store' });
        tracks = await res.json();
      } catch(e){
        console.warn('tracks.json fetch failed', e);
        tracks = [];
      }
    }

    (async function init(){
      // load
      await loadTracks();

      // hero
      if(tracks.length){ playTrack(tracks[0].youtubeId, tracks[0].title); }

      // chips
      const tagSet = new Set();
      tracks.forEach(t => (t.tags||[]).forEach(tag => tagSet.add(String(tag).toLowerCase())));
      const chips = byId('chips');
      chips.innerHTML = [...tagSet].sort().map(tag=>`<button class="chip" data-tag="${tag}">${tag}</button>`).join('');
      chips.addEventListener('click', e=>{
        if(!e.target.classList.contains('chip')) return;
        e.target.classList.toggle('active');
        render();
      });

      // listeners
      byId('q').addEventListener('input', render);
      byId('sortSelect').addEventListener('change', render);

      // render grid
      render();

      // seed assistant with latest 6
      byId('recs').innerHTML =
        recHTML(tracks.slice().sort((a,b)=>new Date(b.releaseDate)-new Date(a.releaseDate)).slice(0,6));
    })();
  </script>
</body>
</html>
